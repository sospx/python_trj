# TorJok - Платформа благотворительности

## Описание проекта

TorJok - это веб-платформа, которая решает проблему разрозненности благотворительной экосистемы. Платформа создает единое пространство для взаимодействия между нуждающимися, частными благотворителями и благотворительными фондами.

### Проблема

Часто люди, которым нужна помощь, не знают, куда обратиться. Благотворители не уверены, что их поддержка дойдет до адресата. Фонды сталкиваются с трудностями в поиске тех, кто действительно нуждается в помощи.

### Решение

TorJok объединяет всех участников благотворительного процесса:

- **Нуждающиеся** могут публиковать запросы на помощь с конкретными потребностями
- **Частные благотворители** предлагают ресурсы, время или деньги
- **Фонды** запускают программы поддержки и привлекают пожертвования

Каждое взаимодействие фиксируется в системе, обеспечивая прозрачность и отслеживаемость помощи.

## Технологический стек

- **Backend**: Python 3.14, Flask 3.1.2
- **База данных**: SQLite (charity.db)
- **Frontend**: HTML, CSS, JavaScript
- **Безопасность**: Bleach для санитизации HTML, хеширование паролей (SHA-256)
- **Обработка файлов**: Pillow для работы с изображениями

## Структура проекта

```
python_trj/
├── main.py                    # Точка входа, инициализация Flask-приложения
├── config.py                  # Конфигурационные параметры приложения
├── database.py                # Модуль работы с базой данных SQLite
├── auth.py                    # Система аутентификации и авторизации
├── utils.py                   # Вспомогательные функции (хеширование паролей)
├── validators.py              # Модуль валидации всех входных данных
├── requirements.txt           # Зависимости Python
├── charity.db                 # База данных SQLite
│
├── routes/                    # Маршруты приложения (контроллеры)
│   ├── __init__.py
│   ├── main.py               # Главная страница и общие маршруты
│   ├── needy.py              # Функционал для нуждающихся
│   ├── donor.py              # Функционал для благотворителей
│   └── fund.py               # Функционал для фондов
│
├── templates/                 # HTML-шаблоны (представление)
│   ├── base.html             # Базовый шаблон с общей разметкой
│   ├── home.html             # Главная страница платформы
│   ├── auth/                 # Шаблоны для аутентификации
│   │   ├── login.html        # Страница входа
│   │   └── register.html     # Страница регистрации
│   ├── needy/                # Личный кабинет нуждающегося
│   │   ├── dashboard_needy.html    # Основная панель
│   │   ├── create_request.html     # Создание запроса
│   │   ├── my_requests.html         # Мои запросы
│   │   ├── available_help.html     # Доступная помощь
│   │   └── responses.html          # Отклики на запросы
│   ├── donor/                # Личный кабинет благотворителя
│   │   ├── dashboard_donor.html    # Основная панель
│   │   ├── create_offer.html       # Создание предложения
│   │   ├── my_offers.html          # Мои предложения
│   │   ├── needy_requests.html     # Запросы нуждающихся
│   │   ├── fund_programs.html      # Программы фондов
│   │   └── responses.html          # Отклики на предложения
│   ├── fund/                 # Личный кабинет фонда
│   │   ├── dashboard_fund.html      # Основная панель
│   │   ├── create_program.html     # Создание программы
│   │   ├── my_programs.html        # Мои программы
│   │   ├── needy_requests.html     # Запросы нуждающихся
│   │   ├── donations.html          # Пожертвования
│   │   └── responses.html          # Отклики на программы
│   └── main/                 # Общие шаблоны
│       ├── dashboard_donor.html
│       ├── dashboard_fund.html
│       └── dashboard_needy.html
│
└── static/                   # Статические ресурсы
    ├── css/                  # Кастомные стили (если есть)
    ├── js/                   # JavaScript файлы
    │   └── validation.js     # Клиентская валидация
    ├── img/                  # Изображения и иконки
    └── uploads/              # Загруженные файлы
        ├── offers/           # Фото предложений благотворителей
        └── requests/         # Фото запросов нуждающихся
```

## Установка и запуск

### Требования

- Python 3.14 или выше
- pip (менеджер пакетов Python)

### Шаги установки

1. Клонируйте репозиторий или скачайте проект

2. Создайте виртуальное окружение (рекомендуется):
```bash
python -m venv venv
```

3. Активируйте виртуальное окружение:
   - На Windows:
     ```bash
     venv\Scripts\activate
     ```
   - На macOS/Linux:
     ```bash
     source venv/bin/activate
     ```

4. Установите зависимости:
```bash
pip install -r requirements.txt
```

5. Настройте конфигурацию (опционально):
   - Отредактируйте `config.py` для изменения настроек
   - Установите переменную окружения `SECRET_KEY` для production

6. Запустите приложение:
```bash
python main.py
```

7. Откройте браузер и перейдите по адресу:
```
http://127.0.0.1:8080
```

## Конфигурация

Основные настройки находятся в файле `config.py`:

- `SECRET_KEY` - секретный ключ для сессий Flask (по умолчанию используется значение из переменной окружения или дефолтное)
- `DATABASE` - имя файла базы данных (по умолчанию 'charity.db')
- `DEBUG` - режим отладки (по умолчанию True)
- `HOST` - хост для запуска сервера (по умолчанию '127.0.0.1')
- `PORT` - порт для запуска сервера (по умолчанию 8080)
- `UPLOAD_FOLDER` - папка для загрузки файлов (по умолчанию 'static/uploads')
- `MAX_FILE_SIZE` - максимальный размер файла (по умолчанию 5MB)
- `ALLOWED_EXTENSIONS` - разрешенные расширения файлов (png, jpg, jpeg, gif, webp)

## База данных

### Структура таблиц

#### users
Хранит информацию о пользователях платформы.

- `id` - уникальный идентификатор
- `email` - email адрес (уникальный)
- `password_hash` - хеш пароля (SHA-256)
- `full_name` - полное имя пользователя
- `user_type` - тип пользователя ('needy', 'donor', 'fund')
- `phone` - номер телефона (опционально)
- `address` - адрес (опционально)
- `description` - описание/биография (опционально)
- `is_verified` - статус верификации (по умолчанию TRUE)
- `created_at` - дата и время регистрации

#### needy_requests
Запросы на помощь от нуждающихся.

- `id` - уникальный идентификатор
- `user_id` - ID пользователя (внешний ключ на users)
- `title` - название запроса
- `description` - описание потребности
- `category` - категория помощи (food, clothes, education, и т.д.)
- `urgency` - уровень срочности (normal, urgent, critical)
- `status` - статус запроса (active, completed)
- `contact_info` - контактная информация
- `photo_path` - путь к фотографии (опционально)
- `quantity` - количество (опционально)
- `created_at` - дата и время создания

#### donor_offers
Предложения помощи от благотворителей.

- `id` - уникальный идентификатор
- `user_id` - ID пользователя (внешний ключ на users)
- `title` - название предложения
- `description` - описание предложения
- `category` - категория помощи
- `help_type` - тип помощи (one_time, regular, consultation, volunteer, other)
- `amount` - сумма (опционально, для денежной помощи)
- `status` - статус предложения (active, completed)
- `contact_info` - контактная информация
- `photo_path` - путь к фотографии (опционально)
- `quantity` - количество (опционально)
- `created_at` - дата и время создания

#### fund_programs
Программы помощи от благотворительных фондов.

- `id` - уникальный идентификатор
- `user_id` - ID пользователя-фонда (внешний ключ на users)
- `title` - название программы
- `description` - описание программы
- `category` - категория помощи
- `target_amount` - целевая сумма сбора
- `current_amount` - текущая собранная сумма
- `status` - статус программы (active, completed)
- `contact_info` - контактная информация
- `created_at` - дата и время создания

#### responses
Отклики пользователей на запросы, предложения и программы.

- `id` - уникальный идентификатор
- `from_user_id` - ID пользователя, который отправил отклик
- `to_user_id` - ID пользователя, которому адресован отклик
- `offer_id` - ID объявления (запроса/предложения/программы)
- `offer_type` - тип объявления ('needy', 'donor', 'fund')
- `message` - сообщение от откликнувшегося
- `status` - статус отклика (new, contacted)
- `from_user_contact` - контактная информация отправителя
- `from_user_name` - имя отправителя
- `quantity` - количество (для откликов на программы фондов)
- `created_at` - дата и время создания

#### donations
Пожертвования в фонды (для будущего функционала).

- `id` - уникальный идентификатор
- `donor_id` - ID благотворителя
- `fund_id` - ID фонда
- `program_id` - ID программы
- `amount` - сумма пожертвования
- `message` - сообщение от благотворителя
- `status` - статус пожертвования (pending, completed)
- `donor_contact` - контактная информация благотворителя
- `donor_name` - имя благотворителя
- `created_at` - дата и время создания

### Инициализация базы данных

База данных автоматически создается при первом запуске приложения через функцию `init_db()` в модуле `database.py`. Таблицы создаются с помощью SQL-запросов CREATE TABLE IF NOT EXISTS, что позволяет безопасно запускать инициализацию несколько раз.

## Функциональные возможности

### Для нуждающихся

1. **Создание запросов**
   - Публикация детализированных обращений о помощи
   - Указание конкретных потребностей
   - Загрузка фотографий
   - Указание категории и уровня срочности
   - Указание количества (если применимо)

2. **Поиск помощи**
   - Просмотр доступных предложений от благотворителей
   - Просмотр программ фондов
   - Фильтрация по категориям

3. **Управление запросами**
   - Просмотр всех своих запросов
   - Закрытие выполненных запросов
   - Отслеживание статуса запросов

4. **Управление откликами**
   - Просмотр откликов на свои запросы
   - Принятие или отклонение предложений помощи
   - Отметка откликов как "связались"
   - Удаление откликов
   - Коммуникация с благотворителями

5. **История взаимодействий**
   - Отслеживание статуса своих запросов
   - Просмотр полученной помощи

### Для благотворителей

1. **Предложения помощи**
   - Публикация доступных ресурсов
   - Указание типа помощи (материальная, вещи, услуги, время, деньги)
   - Загрузка фотографий
   - Указание категории и количества

2. **Поиск запросов**
   - Просмотр актуальных обращений от нуждающихся
   - Фильтрация по категориям
   - Просмотр уровня срочности

3. **Поддержка фондов**
   - Просмотр программ благотворительных организаций
   - Отклик на программы с указанием количества помощи

4. **Управление предложениями**
   - Просмотр всех своих предложений
   - Закрытие выполненных предложений
   - Отслеживание статуса предложений

5. **Управление откликами**
   - Просмотр откликов на свои предложения
   - Отметка откликов как "связались"
   - Удаление откликов
   - Коммуникация с нуждающимися

6. **Прозрачность**
   - Видимость того, кому и как была оказана помощь

### Для фондов

1. **Создание программ**
   - Запуск долгосрочных программ поддержки
   - Указание целевых сборов
   - Описание программы и категории

2. **Управление программами**
   - Просмотр всех своих программ
   - Закрытие завершенных программ
   - Отслеживание статуса программ

3. **Поиск нуждающихся**
   - Просмотр актуальных запросов от нуждающихся
   - Фильтрация по категориям
   - Отклик на запросы

4. **Управление откликами**
   - Просмотр откликов на свои программы
   - Отметка откликов как "связались"
   - Удаление откликов
   - Коммуникация с благотворителями и нуждающимися

5. **Отчетность**
   - Автоматическая генерация статистики по программам
   - Отслеживание собранных средств

## Безопасность

### Аутентификация и авторизация

- Пароли хранятся в виде хешей SHA-256 (не в открытом виде)
- Использование сессий Flask для управления авторизацией
- Декораторы `@login_required` и `@user_type_required` для защиты маршрутов
- Проверка типа пользователя для доступа к специфичным функциям

### Валидация данных

Модуль `validators.py` содержит комплексную систему валидации:

- **Валидация email**: проверка формата и длины
- **Валидация пароля**: минимальная длина 6 символов, максимум 128
- **Валидация текстовых полей**: проверка длины и обязательности
- **Валидация категорий**: проверка на соответствие разрешенным значениям
- **Валидация файлов**: проверка расширения и размера (макс. 5MB)
- **Валидация телефонов**: проверка формата и длины
- **Валидация количества**: проверка на положительные числа

### Защита от XSS

- Использование библиотеки Bleach для санитизации HTML
- Разрешены только безопасные теги форматирования
- Автоматическая очистка всех пользовательских вводов

### Загрузка файлов

- Проверка расширения файла
- Проверка размера файла (максимум 5MB)
- Генерация уникальных имен файлов (UUID)
- Сохранение в безопасные директории

## API и маршруты

### Публичные маршруты

- `GET /` - главная страница
- `GET /register` - страница регистрации
- `POST /register` - обработка регистрации
- `GET /login` - страница входа
- `POST /login` - обработка входа
- `GET /logout` - выход из системы

### Маршруты для нуждающихся (`/needy`)

- `GET /needy/create-request` - форма создания запроса
- `POST /needy/create-request` - обработка создания запроса
- `GET /needy/my-requests` - список моих запросов
- `GET /needy/available-help` - доступная помощь
- `POST /needy/respond-to-offer/<offer_id>/<offer_type>` - отклик на предложение
- `GET /needy/responses` - отклики на мои запросы
- `POST /needy/mark-response-contacted/<response_id>` - отметка отклика
- `DELETE /needy/delete-response/<response_id>` - удаление отклика
- `GET /needy/close-request/<request_id>` - закрытие запроса

### Маршруты для благотворителей (`/donor`)

- `GET /donor/create-offer` - форма создания предложения
- `POST /donor/create-offer` - обработка создания предложения
- `GET /donor/my-offers` - список моих предложений
- `GET /donor/needy-requests` - запросы нуждающихся
- `POST /donor/respond-to-request/<request_id>` - отклик на запрос
- `GET /donor/fund-programs` - программы фондов
- `POST /donor/respond-to-fund-program/<program_id>` - отклик на программу
- `GET /donor/responses` - отклики на мои предложения
- `POST /donor/mark-response-contacted/<response_id>` - отметка отклика
- `DELETE /donor/delete-response/<response_id>` - удаление отклика
- `GET /donor/close-offer/<offer_id>` - закрытие предложения

### Маршруты для фондов (`/fund`)

- `GET /fund/create-program` - форма создания программы
- `POST /fund/create-program` - обработка создания программы
- `GET /fund/my-programs` - список моих программ
- `GET /fund/needy-requests` - запросы нуждающихся
- `POST /fund/respond-to-request/<request_id>` - отклик на запрос
- `GET /fund/responses` - отклики на мои программы
- `POST /fund/mark-response-contacted/<response_id>` - отметка отклика
- `DELETE /fund/delete-response/<response_id>` - удаление отклика
- `GET /fund/close-program/<program_id>` - закрытие программы

### Общие маршруты

- `GET /dashboard` - перенаправление на dashboard по типу пользователя
- `GET /dashboard/<user_type>` - личный кабинет пользователя

## Зависимости

Все зависимости перечислены в `requirements.txt`:

- `Flask==3.1.2` - веб-фреймворк
- `bleach==6.3.0` - санитизация HTML
- `pillow==12.0.0` - обработка изображений
- `Werkzeug==3.1.4` - утилиты WSGI
- `Jinja2==3.1.6` - шаблонизатор
- `MarkupSafe==3.0.3` - безопасная обработка строк
- `itsdangerous==2.2.0` - безопасная сериализация
- `click==8.3.1` - CLI утилиты
- `blinker==1.9.0` - сигналы
- `webencodings==0.5.1` - кодировки для web

## Разработка

### Структура кода

Проект следует принципам модульности:

- **Разделение ответственности**: каждый модуль отвечает за свою область
- **Blueprint'ы Flask**: маршруты организованы по функциональным областям
- **Валидация**: централизованная система валидации в `validators.py`
- **Безопасность**: санитизация всех пользовательских данных

### Добавление нового функционала

1. Создайте новый маршрут в соответствующем Blueprint
2. Добавьте валидацию в `validators.py` (если требуется)
3. Создайте HTML-шаблон в соответствующей директории
4. Обновите базу данных (если требуется новая таблица или поле)

### Тестирование

Для тестирования функционала:

1. Запустите приложение в режиме отладки (`DEBUG=True`)
2. Создайте тестовых пользователей разных типов
3. Проверьте создание запросов, предложений и программ
4. Проверьте систему откликов
5. Проверьте валидацию форм

## Развертывание в production

### Рекомендации

1. **Измените SECRET_KEY**: установите надежный секретный ключ через переменную окружения
2. **Отключите DEBUG**: установите `DEBUG=False` в `config.py`
3. **Используйте production WSGI сервер**: например, Gunicorn или uWSGI
4. **Настройте HTTPS**: используйте SSL/TLS сертификаты
5. **Резервное копирование БД**: регулярно делайте бэкапы `charity.db`
6. **Мониторинг**: настройте логирование и мониторинг ошибок
7. **Ограничение размера файлов**: убедитесь, что веб-сервер ограничивает размер загружаемых файлов

### Пример запуска с Gunicorn

```bash
pip install gunicorn
gunicorn -w 4 -b 0.0.0.0:8080 main:create_app()
```

## Известные ограничения

1. **SQLite**: база данных SQLite подходит для небольших и средних проектов. Для больших нагрузок рекомендуется PostgreSQL или MySQL
2. **Хеширование паролей**: используется SHA-256, что менее безопасно, чем bcrypt или argon2. Рекомендуется обновить для production
3. **Файловое хранилище**: загруженные файлы хранятся локально. Для масштабирования рекомендуется использовать облачное хранилище (S3, Azure Blob и т.д.)
4. **Отсутствие email-уведомлений**: система не отправляет уведомления по email
5. **Отсутствие платежной системы**: пожертвования в фонды пока не реализованы полностью

## Будущие улучшения

- Интеграция платежной системы для пожертвований
- Email-уведомления о новых откликах
- Система рейтингов и отзывов
- Расширенная система фильтров и поиска
- Мобильное приложение
- Интеграция с социальными сетями
- Система верификации пользователей
- Аналитика и отчетность для фондов
- Многоязычность
- API для сторонних приложений

## Лицензия

[Укажите лицензию проекта]

## Контакты

[Укажите контактную информацию]

## Благодарности

Проект создан для объединения благотворительной экосистемы и упрощения процесса оказания помощи нуждающимся.

