{% extends "base.html" %}

{% block content %}
<div class="row">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header gradient-bg text-white d-flex justify-content-between align-items-center">
                <h4 class="mb-0"><i class="fas fa-project-diagram me-2"></i>–ú–æ–∏ –ø—Ä–æ–≥—Ä–∞–º–º—ã –ø–æ–º–æ—â–∏</h4>
                <a href="/fund/create-program" class="btn btn-light">
                    <i class="fas fa-plus me-2"></i>–ù–æ–≤–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞
                </a>
            </div>
            <div class="card-body">
                {% if programs %}
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead class="table-light">
                            <tr>
                                <th>–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã</th>
                                <th>–ì–æ—Ä–æ–¥</th>
                                <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                                <th>–°–±–æ—Ä—ã</th>
                                <th>–ü—Ä–æ–≥—Ä–µ—Å—Å</th>
                                <th>–°—Ç–∞—Ç—É—Å</th>
                                <th>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è</th>
                                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for program in programs %}
                            <tr>
                                <td>
                                    <strong>{{ program.title }}</strong>
                                    <br>
                                    <small class="text-muted">{{ program.description[:100] }}{% if program.description|length > 100 %}...{% endif %}</small>
                                </td>
                                <td>
                                    <i class="fas fa-map-marker-alt text-danger"></i>
                                    {{ program.city or '–ù–µ —É–∫–∞–∑–∞–Ω' }}
                                </td>
                                <td>
                                    <span class="badge bg-light text-dark">
                                        {% if program.category == 'food' %}üçé –ü–∏—Ç–∞–Ω–∏–µ
                                        {% elif program.category == 'medicine' %}üíä –ú–µ–¥–∏—Ü–∏–Ω–∞
                                        {% elif program.category == 'clothes' %}üëï –û–¥–µ–∂–¥–∞
                                        {% elif program.category == 'money' %}üí∞ –§–∏–Ω–∞–Ω—Å—ã
                                        {% elif program.category == 'housing' %}üè† –ñ–∏–ª—å–µ
                                        {% elif program.category == 'education' %}üéì –û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ
                                        {% else %}‚ùì –î—Ä—É–≥–æ–µ{% endif %}
                                    </span>
                                </td>
                                <td>
                                    {% if program.target_amount %}
                                        <strong>{{ program.current_amount }} ‚ÇΩ</strong>
                                        <br>
                                        <small>–∏–∑ {{ program.target_amount }} ‚ÇΩ</small>
                                    {% else %}
                                        <span class="text-muted">–ù–µ —É–∫–∞–∑–∞–Ω–æ</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if program.target_amount and program.target_amount > 0 %}
                                    <div class="progress" style="height: 8px; width: 100px;">
                                        <div class="progress-bar bg-warning"
                                             style="width: {{ (program.current_amount / program.target_amount * 100) if program.target_amount > 0 else 0 }}%">
                                        </div>
                                    </div>
                                    <small>{{ ((program.current_amount / program.target_amount * 100) if program.target_amount > 0 else 0)|round(1) }}%</small>
                                    {% else %}                                    <span class="text-muted">‚Äî</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if program.status == 'active' %}
                                        <span class="badge bg-success"><i class="fas fa-play me-1"></i>–ê–∫—Ç–∏–≤–Ω–∞</span>
                                    {% elif program.status == 'completed' %}
                                        <span class="badge bg-secondary"><i class="fas fa-check me-1"></i>–ó–∞–≤–µ—Ä—à–µ–Ω–∞</span>
                                    {% else %}
                                        <span class="badge bg-warning">{{ program.status }}</span>
                                    {% endif %}
                                </td>
                                <td>{{ program.created_at[:16] }}</td>
                                <td>
                                    <div class="btn-group btn-group-sm">
                                        {% if program.status == 'active' %}
                                            <a href="/fund/close-program/{{ program.id }}" class="btn btn-outline-danger"
                                               onclick="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –∑–∞–∫—Ä—ã—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—É?')">
                                                <i class="fas fa-stop me-1"></i>–ó–∞–∫—Ä—ã—Ç—å
                                            </a>
                                        {% endif %}
                                        <button class="btn btn-outline-primary" data-bs-toggle="modal"
                                                data-bs-target="#programModal{{ program.id }}">
                                            <i class="fas fa-eye me-1"></i>–ü—Ä–æ—Å–º–æ—Ç—Ä
                                        </button>
                                    </div>
                                </td>
                            </tr>

                            <!-- Modal –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø—Ä–æ–≥—Ä–∞–º–º—ã -->
                            <div class="modal fade" id="programModal{{ program.id }}" tabindex="-1">
                                <div class="modal-dialog modal-lg">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h5 class="modal-title">–ü—Ä–æ–≥—Ä–∞–º–º–∞: {{ program.title }}</h5>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                        </div>
                                        <div class="modal-body">
                                            <div class="mb-3">
                                                <strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong>
                                                <p class="mt-2">{{ program.description }}</p>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <strong>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</strong>
                                                    <p>
                                                        {% if program.category == 'food' %}üçé –ü–∏—Ç–∞–Ω–∏–µ
                                                        {% elif program.category == 'medicine' %}üíä –ú–µ–¥–∏—Ü–∏–Ω–∞
                                                        {% elif program.category == 'clothes' %}üëï –û–¥–µ–∂–¥–∞
                                                        {% elif program.category == 'money' %}üí∞ –§–∏–Ω–∞–Ω—Å—ã
                                                        {% elif program.category == 'housing' %}üè† –ñ–∏–ª—å–µ
                                                        {% elif program.category == 'education' %}üéì –û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ
                                                        {% else %}‚ùì –î—Ä—É–≥–æ–µ{% endif %}
                                                    </p>
                                                </div>                                                <div class="col-md-6">
                                                    <strong>–°—Ç–∞—Ç—É—Å:</strong>
                                                    <p>
                                                        {% if program.status == 'active' %}
                                                            <span class="badge bg-success">–ê–∫—Ç–∏–≤–Ω–∞</span>
                                                        {% else %}
                                                            <span class="badge bg-secondary">{{ program.status }}</span>
                                                        {% endif %}
                                                    </p>
                                                </div>
                                            </div>
                                            {% if program.target_amount %}
                                            <div class="row">
                                                <div class="col-md-12">
                                                    <strong>–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å:</strong>
                                                    <div class="progress mt-2" style="height: 20px;">
                                                        <div class="progress-bar bg-warning"
                                                             style="width: {{ (program.current_amount / program.target_amount * 100) if program.target_amount > 0 else 0 }}%">
                                                            {{ ((program.current_amount / program.target_amount * 100) if program.target_amount > 0 else 0)|round(1) }}%
                                                        </div>
                                                    </div>
                                                    <div class="text-center mt-2">
                                                        <strong>{{ program.current_amount }} ‚ÇΩ</strong> –∏–∑
                                                        <strong>{{ program.target_amount }} ‚ÇΩ</strong>
                                                    </div>
                                                </div>
                                            </div>
                                            {% endif %}
                                            {% if program.contact_info %}
                                            <div class="mt-3">
                                                <strong>–ö–æ–Ω—Ç–∞–∫—Ç—ã:</strong>
                                                <p>{{ program.contact_info }}</p>
                                            </div>
                                            {% endif %}
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–ó–∞–∫—Ä—ã—Ç—å</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="text-center py-4">
                    <div class="feature-icon text-muted mb-3">
                        <i class="fas fa-project-diagram"></i>
                    </div>
                    <h5>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –ø—Ä–æ–≥—Ä–∞–º–º</h5>
                    <p class="text-muted">–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É –ø–æ–º–æ—â–∏ –¥–ª—è –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è –±–ª–∞–≥–æ—Ç–≤–æ—Ä–∏—Ç–µ–ª–µ–π</p>
                    <a href="/fund/create-program" class="btn btn-warning mt-3">
                        <i class="fas fa-plus me-2"></i>–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—É
                    </a>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}