{% extends "base.html" %}

{% block content %}
<div class="row">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header gradient-bg text-white d-flex justify-content-between align-items-center">
                <h4 class="mb-0"><i class="fas fa-inbox me-2"></i>–û—Ç–∫–ª–∏–∫–∏ –Ω–∞ –º–æ–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è</h4>
                <a href="/donor/create-offer" class="btn btn-light">
                    <i class="fas fa-plus me-2"></i>–°–æ–∑–¥–∞—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ
                </a>
            </div>
            <div class="card-body">
                
                {% if responses %}
                <div class="row">
                    {% for response in responses %}
                    <div class="col-md-6 mb-4">
                        <div class="card h-100 border-info">
                            <div class="card-header bg-info text-white d-flex justify-content-between align-items-center">
                                <h6 class="mb-0">–û—Ç–∫–ª–∏–∫ –æ—Ç {{ response.needy_name }}</h6>
                                <span class="badge bg-light text-info">
                                    {% if response.status == 'new' %}
                                        –ù–æ–≤—ã–π
                                    {% elif response.status == 'viewed' %}
                                        –ü—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω
                                    {% elif response.status == 'contacted' %}
                                        –°–≤—è–∑—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞
                                    {% else %}
                                        {{ response.status }}
                                    {% endif %}
                                </span>
                            </div>
                            <div class="card-body">
                                <p class="card-text"><strong>–°–æ–æ–±—â–µ–Ω–∏–µ:</strong> {{ response.message }}</p>
                                
                                <div class="mb-2">
                                    <strong><i class="fas fa-user me-2"></i>–ò–º—è –Ω—É–∂–¥–∞—é—â–µ–≥–æ—Å—è:</strong> {{ response.needy_name }}
                                </div>
                                
                                <div class="mb-2">
                                    <strong><i class="fas fa-phone me-2"></i>–ö–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è —Å–≤—è–∑–∏:</strong> 
                                    <span class="text-primary">{{ response.needy_contact }}</span>
                                </div>
                                
                                <div class="mb-2">
                                    <strong><i class="fas fa-gift me-2"></i>–ù–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:</strong> {{ response.offer_title }}
                                </div>
                                
                                <small class="text-muted">
                                    <i class="fas fa-clock me-1"></i>–ü–æ–ª—É—á–µ–Ω–æ: {{ response.created_at[:16] }}
                                </small>
                            </div>
                            <div class="card-footer">
                                <div class="btn-group btn-group-sm">
                                    <button class="btn btn-outline-success contact-btn" 
                                            data-contact="{{ response.needy_contact }}"
                                            data-name="{{ response.needy_name }}">
                                        <i class="fas fa-phone me-1"></i>–°–≤—è–∑–∞—Ç—å—Å—è
                                    </button>
                                    <button class="btn btn-outline-primary mark-contacted-btn"
                                            data-response-id="{{ response.id }}">
                                        <i class="fas fa-check me-1"></i>–û—Ç–º–µ—Ç–∏—Ç—å —Å–≤—è–∑—å
                                    </button>
                                    <button class="btn btn-outline-danger delete-response-btn"
                                            data-response-id="{{ response.id }}">
                                        <i class="fas fa-trash me-1"></i>–£–¥–∞–ª–∏—Ç—å
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="text-center py-4">
                    <div class="feature-icon text-muted mb-3">
                        <i class="fas fa-inbox"></i>
                    </div>
                    <h5>–ü–æ–∫–∞ –Ω–µ—Ç –æ—Ç–∫–ª–∏–∫–æ–≤</h5>
                    <p class="text-muted">–ö–∞–∫ —Ç–æ–ª—å–∫–æ –Ω—É–∂–¥–∞—é—â–∏–µ—Å—è –Ω–∞—á–Ω—É—Ç –æ—Ç–∫–ª–∏–∫–∞—Ç—å—Å—è –Ω–∞ –≤–∞—à–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è, –æ—Ç–∫–ª–∏–∫–∏ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å</p>
                    <a href="/donor/create-offer" class="btn btn-primary mt-3">
                        <i class="fas fa-plus me-2"></i>–°–æ–∑–¥–∞—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –ø–æ–º–æ—â–∏
                    </a>
                </div>
                {% endif %}
                
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // –ö–Ω–æ–ø–∫–∞ "–°–≤—è–∑–∞—Ç—å—Å—è" - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–Ω—Ç–∞–∫—Ç—ã
    document.querySelectorAll('.contact-btn').forEach(button => {
        button.addEventListener('click', function() {
            const contact = this.getAttribute('data-contact');
            const name = this.getAttribute('data-name');
            alert(`üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã ${name}: ${contact}\n\n–°–≤—è–∂–∏—Ç–µ—Å—å —Å –Ω—É–∂–¥–∞—é—â–∏–º—Å—è –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –ø–æ–º–æ—â–∏.`);
        });
    });
    
    // –ö–Ω–æ–ø–∫–∞ "–û—Ç–º–µ—Ç–∏—Ç—å —Å–≤—è–∑—å"
    document.querySelectorAll('.mark-contacted-btn').forEach(button => {
        button.addEventListener('click', function() {
            const responseId = this.getAttribute('data-response-id');
            fetch(`/donor/mark-response-contacted/${responseId}`, {
                method: 'POST'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('‚úÖ –°—Ç–∞—Ç—É—Å –æ–±–Ω–æ–≤–ª–µ–Ω!');
                    location.reload();
                } else {
                    alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞');
                }
            });
        });
    });
    
    // –ö–Ω–æ–ø–∫–∞ "–£–¥–∞–ª–∏—Ç—å"
    document.querySelectorAll('.delete-response-btn').forEach(button => {
        button.addEventListener('click', function() {
            const responseId = this.getAttribute('data-response-id');
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –æ—Ç–∫–ª–∏–∫?')) {
                fetch(`/donor/delete-response/${responseId}`, {
                    method: 'DELETE'
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('‚úÖ –û—Ç–∫–ª–∏–∫ —É–¥–∞–ª–µ–Ω!');
                        location.reload();
                    } else {
                        alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –æ—Ç–∫–ª–∏–∫–∞');
                    }
                });
            }
        });
    });
});
</script>
{% endblock %}

